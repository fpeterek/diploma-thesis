\chapter{TILScript}

Nyní konečně přišel čas představit TILScript. TILScript je interpretovaný funkcionální programovací
jazyk, do znatelné míry inspirovaný jazyky jako Haskell nebo Lisp. Syntax TILScriptu by měla co
nejvíce připomínat syntaktické prvky Transparentní intenzionální logiky, aby pouhá znalost TILu
stačila k okamžitému pochopení TILScriptu. Sémantika by poté měla být stejná.

Tato kapitola je rozdělena do tří sekcí. V první sekci jsou popsány důležité základní rysy
TILScriptu. Druhá sekce popisuje již existující prvky TILScriptu, a případně dokumentuje změny
oproti předchozím verzím TILScriptu. Poslední sekce se věnuje navrhovaným rozšířením jazyka
TILScript.

\section{Charakteristické rysy TILScriptu}

Tato sekce popisuje charakteristické rysy TILScriptu v takové podobě, jakou nabývá v této práci.
Pokud se v některém bodě TILScript neshoduje s TILem či předchozími verzemi TILScriptu, je rozdíl
náležitě popsán a vysvětlen.

\subsection{Lambda kalkul parciálních funkcí}

\subsubsection{Shora neomezená arita funkcí}

% TODO: Ozdrojovat currying asi? Idk, lambda kalkul

Narozdíl od lambda kalkulu ve své tradiční podobě, nebo například jazyka Haskell, v Transparentní
intezionální logice není arita funkce shora omezená. TILScript musí tento fakt reflektovat. Proto
tento jazyk umožňuje definici i aplikaci funkcí libovolné (samozřejmě nezáporné) arity. Také zde
neexistuje rozvíjení funkcí (anglicky \textit{currying}). Zatímco např. v Haskellu jsou funkce
arity dvě nebo vyšší automaticky rozvinuty na sérií několika unárních funkcí, jejichž oborem hodnot
jsou unární nebo nulární funkce, a jedné nulární funkce která vrací žádaný výsledek, v TILScriptu
není arita nijak omezená.

\subsubsection{Parciální funkce a respektování principu kompozicionality}

Jelikož v TIL můžou být funkce parciální, musí i TILScript počítat s parcialitou funkcí. Dále musí
TILScript respektovat princip kompozicionality, základní rys Transparentní intenzionální logiky.
Jedním z důsledků principu kompozicionality je, že konstrukce, jejíž přinejmenším jeden konstituent
je nevlastní, bude také nutně nevlastní. Reprezentaci stavu, kdy parciální funkce je aplikována
na argumenty, na kterých není definována, se věnuje podsekce \textit{Hodnota Nil} \ref{nil-value}
této kapitoly. Způsob dodržování principu kompozicionality je popsán v podsekci
\textit{Okamžité vyhodnocování (Eager evaluation)} \ref{eager-eval}.

%TODO: Ocitovat
Jedinou výjimkou je funkce \lstinline{IsNil}, jež vrací pravdivostní hodnotu \lstinline{True},
pokud je její jediný argument \lstinline{Nil}, v opačném případě je jejím výsledkem
\lstinline{False}. Tato speciální sémantika funkce \lstinline{IsNil}, ačkoliv porušuje princip
kompozicionality a vyžaduje aplikaci unární funkce na "nic," je zvolena jako doplněk k funkci
\lstinline{Improper/(o*_n)} definované v Průvodci čtenáře, a jako kompromis mezi dodržením
principů TIL a umožněním zpracování chyb.

\subsection{Neměnnost proměnných a symbolů (\textit{Immutability})}

Jelikož je TILScript funkcionální jazyk, jsou hodnoty všech proměnných konstantní -- tedy
jakmile je proměnné jednou přiřazena valuace, nelze její hodnotu změnit. Dále nelze proměnnou
zastínit (angl. \textit{to shadow, shadowing}) v rámci oblasti platnosti (angl. \textit{scope}),
ve které byla definována. Proměnnou lze zastínit vytvořením nové oblasti platnosti (tedy například
na novém rámci zásobníku, angl. \textit{stack frame}).

Obdobně nelze redefinovat funkce nebo změnit typ symbolické hodnoty (viz \ref{symbolic-values}).

\subsection{Okamžité vyhodnocování (\textit{Eager evaluation})} \label{eager-eval}

%TODO: Toto potřebuju vyhodnotit a dopsat, až zjistím, jak vlastně funguje lazy evaluace v TIL

\subsection{Definice a deklarace symbolů}

TILScript nově rozlišuje mezi deklaracemi a definicemi proměnných a funkcí. Deklarace pouze
uvědomí překladač o existenci proměnné nebo funkce, nijak ale nedefinuje valuaci proměnné nebo
sémantiku funkce. Deklarace umožňuje funkci či proměnnou zmínit (např. v trivializaci, v uzávěru),
neumožňuje nám však proměnnou provést nebo funkci aplikovat -- jak také, když neznáme hodnotu
proměnné, případně sémantiku dané funkce. Provedení deklarované, avšak nedefinované proměnné
je chybou, při které interpreter ohlásí chybu a běh programu je ukončen. Deklarovat jeden symbol
lze vícekrát, deklarace však nesmí být konfliktní a lišit se typy.

\begin{lstlisting}[caption={Hlášení chyby při chybějící definici}]
$ java -jar interpreter/build/libs/tilscript.jar examples/undef-var.tils
** Error **
(4, 1): myVar.
    ~~~ ^ ~~~
        Variable 'myVar' is declared but undefined
$ java -jar interpreter/build/libs/tilscript.jar examples/undef-fn.tils
** Error **
(2, 1): MyFn/(Int Int Int).
    ~~~ ^ ~~~
        Function MyFn is declared but undefined, application is impossible
\end{lstlisting}

Definice přiřadí proměnné valuaci, funkci sémantiku. Proměnné s řádnou definicí lze provést
a můžou tak být konstituentem prováděné konstrukce. Funkce s řádnou definicí lze aplikovat. Funkce
i proměnné lze definovat pouze jednou. Opakovaná definice je chybou a vyústí v předčasné ukončení
programu.

Symbolické hodnoty, viz \ref{symbolic-values}, lze pouze deklarovat.

Deklarace jsou automaticky odvozeny z definic. Proto, pokud je známa definice, není třeba dodávat
také deklaraci. K interpretaci deklarací automaticky dochází před interpretací definic, aby byla
umožněna např. definice vzájemně rekurzivních funkcí. Definice jsou interpretovány v takovém
pořadí, v jakém jsou uvedené ve zdrojovém kódu.

Deklarace bez řádných definic na první pohled můžou působit zbytečně. K čemu může sloužit funkce,
kterou nelze aplikovat? Nesmíme však zapomenout, že konstrukce TIL samy vyjadřují význam, a nemusí
nutně sloužit k provedení. Provedením konstrukce sice dostaneme její denotát, ten nás ale ne vždy
zajímá. Představme si tedy případ, kdy provádíme analýzu výrazu přirozeného jazyka. Výraz
analyzujeme pomocí Transparentní intenzionální logiky a získáme konstrukci. S danou konstrukcí
chceme dále pracovat a chceme ji strojově zpracovat. Její denotát nás ovšem nezajímá, zajímá nás
pouze význam konstrukce. Současně daná konstrukce obsahuje funkci, jejíž definici neznáme, známe,
ale nejsme schopni ji strojově vyjádřit, nebo nás pouze nezajímá. Jelikož víme, že konstrukci
nebudeme provádět, a tedy nebudeme ani aplikovat funkci v ní zmíněnou, nepotřebujeme znát její
přesnou definici. Stačí nám znát pouze její název a typ.

Jako příklad nevyjádřitelné funkce lze uvést například všeobecný kvantifikátor. Ačkoliv všeobecný
kvantifikátor existuje jako funkce v Transparentní intenzionální logice, nelze jej korektně
definovat tak, aby byl vždy strojově vyhodnotitelný.

Názvosloví \textit{deklarace}, \textit{definice} je převzáno z programovacího jazyka C, kde
deklarace pouze uvědomí překladač o existenci symbolu, definice poté přiřadí symbolu konkrétní
hodnotu. Počet deklarací je shora neomezený, zato definice může existovat nanejvýš jedna. Deklarace
nedefinovaného symbolu není chybou, ovšem snaha nedefinovaný symbol využít (např. volání funkce,
přístup k proměnné) vyústí v chybu při procesu linkování.

\section{TILScript jako výpočetní varianta TILu}

Tato sekce popisuje základní výrazy a konstrukce TILScriptu, které existovaly již v předchozích
verzích jazyka. Pokud práce tyto výrazy nějakým způsobem upravuje, je úprava náležitě popsána
a zdůvodněna.

\subsection{Atomické datové typy}

Atomické datové typy v TILScriptu vycházejí z výchozí báze využívané v Transparentní intenzionální
logice k analýze přirozeného jazyka, tedy množinám ${o, \iota, \tau, \omega}$. TILScript ovšem
rozlišuje mezi časy a reálnými čísly, a pro tyto hodnoty definuje dva nekompatibilní typy, mezi
kterými neexistuje implicitní konverze. Dále TILScript využívá datový typ $\nu$ představující celá
čísla. Nakonec TILScript pro názvy typů nevyužívá řecká písmena, která nelze prakticky a jednoduše
zapisovat na spoustě rozložení klávesnic, ale anglická slova nebo zkratky. Názvy typů vždy začínají
velkým písmenem.

Typ $o$ představující pravdivostní hodnoty TILScript pojmenovává \lstinline{Bool} a může nabývat
hodnot \lstinline{True} a \lstinline{False}.

Typ $\iota$, v TILScriptu \lstinline{Indiv}, označujeme jako množinu individuí. Individua
v Transparentní intenzionální logice považujeme za "holá" -- žádnou netriviální vlastnost nemají
nutně. Všechny netriviální vlastnosti individuí jsou určeny stavem světa. Individuum samotné nemá
žádnou inherentní valuaci. Slouží pouze jako unikátní indentifikátor. Obdobně hodnoty
\lstinline{Indiv} v jazyce TILScript nemají žádnou konkrétní reprezentaci. Typ \lstinline{Indiv}
je využíván v konjunkci se symbolickými hodnotami, viz \ref{symbolic-values}. Tímto TILScript
umožňuje uživateli referovat na konkrétní individuum pouze pomocí symbolického identifikátoru,
aniž by individuím musely být přiřazeny arbitrárně zvolené konkrétní hodnoty.

Reálná čísla TILScript reprezentuje typem \lstinline{Real}. V implementaci překladače vytvořeném
v rámci této práce jsou reálná čísla interně reprezentována typem \lstinline{double}. TILScript
samotný žádné omezení na reprezentaci reálných čísel nestanovuje, prakticky však reálná čísla
v současné implementaci reprezentujeme pomocí 64bitové reprezentace dle IEEE 754.

Celá čísla TILScript reprezentuje typem \lstinline{Int}. Obdobně jako u typu \lstinline{Real}
neexistuje omezení pro reprezentaci celých čísel. Interně je využíván datový typ \lstinline{long},
jedná se tedy o 64bitové znaménkové číslo reprezentované dvojkovým doplňkem.

Množinu možných časů modelujeme typem \lstinline{Time}. Pro interní reprezentaci časových okamžiků
byl v této práci zvolen datový typ \lstinline{long}. Uživatel se sám může rozhodnout, jak bude tyto
hodnoty interpretovat. Ve standardní knihovně lze však nalézt např. funkci \lstinline{Now}, jejíž
aplikací získáme počet milisekund uplynulých od 1. ledna 1970.

Dále byl TILScript rozšířen o atomický typ sloužící k reprezentaci textu. Tento typ je podrobněji
popsán v sekci o rozšířeních TILScriptu, viz \ref{text-type}.

\subsection{Generický typ \textit{Any}}

\subsection{Funkce}

\subsection{Trivializace}

\subsection{Literály}

\subsection{Proměnné}

\subsection{Provedení}

\subsection{Kompozice}

\subsection{Uzávěry}

\subsection{N-tice}

\subsection{Seznamy}

\subsection{Symbolické hodnoty} \label{symbolic-values}

\section{Rozšíření TILScriptu}

\subsection{Typ \textit{Text}} \label{text-type}

\subsection{Hodnota \textit{Nil}} \label{nil-value}

\endinput
